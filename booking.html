<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking - Minimal B&W</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
   <a href="index.html" class="back-link-float">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
    <span>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span>
</a>

<style>
.back-link-float {
    position: fixed;
    top: 20px;
    left: 20px;
    background: rgba(255, 255, 255, 0.8);
    padding: 8px 12px;
    border-radius: 50px;
    display: flex;
    align-items: center;
    gap: 5px;
    text-decoration: none;
    color: #000;
    font-weight: 500;
    font-size: 14px;
    border: 1px solid #eee;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    z-index: 9999;
}
.back-link-float:hover {
    background: #000;
    color: #fff;
}
/* ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (Modal) */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 10000;
    justify-content: center;
    align-items: center;
    padding: 20px;
}

.modal-content {
    background-color: #fff;
    padding: 25px;
    border-radius: 15px;
    width: 100%;
    max-width: 400px;
    text-align: center;
    box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    position: relative;
}

.modal-content h3 {
    margin-bottom: 10px;
}

.qr-img {
    margin: 15px 0;
    border: 1px solid #eee;
    border-radius: 8px;
    max-width: 100%;
}

.btn-submit {
    background: #000;
    color: #fff;
    border: none;
    padding: 12px 25px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    width: 100%;
    margin-top: 15px;
}

.btn-submit:disabled {
    background: #999;
}

/* --- ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡∏™‡πà‡∏ß‡∏ô Loading Overlay ‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡πÑ‡∏õ --- */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.9);
    z-index: 99999;
    display: flex; /* Flex ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏∏‡∏°‡∏î‡πâ‡∏ß‡∏¢ JS ‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ */
    justify-content: center;
    align-items: center;
    flex-direction: column;
}
.spinner-box {
    text-align: center;
}
.spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #f3f3f3;
    border-top: 5px solid #000;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 15px auto;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

    <div class="container">
        <header>
            <img width="200" height="150" src="image/TR.png" alt="Shoe Service Logo" class="header-logo">
            <p style="color:#666; font-size:14px;">‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ã‡∏±‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤</p>
        </header>

        <form id="bookingForm">
            <div class="row1">
                <div class="form-group">
                    <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ (Phone)</label>
                    <input type="tel" name="phone" required>
                </div>
            </div>

            <hr>

            <div class="form-group">
                <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤ (Shoe Type)</label>
                <select name="shoe_type" id="shoeType" required onchange="calculateTotal()">
                    <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                    <option value="basketball">‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏ö‡∏≤‡∏™ (basketball shoes)</option>
                    <option value="sneakers">‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏ú‡πâ‡∏≤‡πÉ‡∏ö (Sneakers)</option>
                    <option value="Suede sneakers">‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏ú‡πâ‡∏≤‡πÉ‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏Å‡∏•‡∏±‡∏ö (Suede sneakers)</option>
                    <option value="Nubuck">‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏ô‡∏π‡∏ö‡∏±‡∏Ñ (Nubuck leather shoes)</option>
                    <option value="boots">‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏´‡∏ô‡∏±‡∏á (leather)</option>
                    <option value="sandals">‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡πÅ‡∏ï‡∏∞ (Sandals)</option>
                    <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (Other)</option>
                </select>
            </div>
            

            <div class="row">
                <div class="form-group">
                    <label>‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå (Brand)</label>
                    <input type="text" name="brand" placeholder="‡πÄ‡∏ä‡πà‡∏ô Nike, Adidas, Unbrand" required>
                </div>
                <div class="form-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πà‡∏ô (Model) <span style="font-weight:300; color:#999;">(‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</span></label>
                    <input type="text" name="model" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏∏‡πà‡∏ô (‡∏ñ‡πâ‡∏≤‡∏ó‡∏£‡∏≤‡∏ö)">
                </div>
            </div>

            <hr>

            <div class="row">
                <div class="form-group">
                    <label>‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤ </label>
                    <input type="date" name="pickup_date" required>
                </div>
                <div class="form-group">
                    <label>‡∏ß‡∏±‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤ *‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 3 ‡∏ß‡∏±‡∏ô</label>
                    <input type="date" name="return_date" required>
                </div>
            </div>

            <div class="form-group">
                <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà / Google Maps (Address)</label>
                <textarea name="address" rows="3" placeholder="‡πÅ‡∏õ‡∏∞‡∏•‡∏¥‡∏á‡∏Å‡πå Google Maps ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á..." required></textarea>
            </div>

            <div class="form-group">
                <label>Note / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                <textarea name="note" rows="2" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏≠‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÜ, ‡∏á‡∏≤‡∏ô‡∏î‡πà‡∏ß‡∏ô (Extra Charge)"></textarea>
            </div>
            
            <div class="form-group" style="text-align: left; margin-top: 20px;">
                <label>‡πÅ‡∏ô‡∏õ‡∏£‡∏π‡∏õ‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡∏∞</label>
                <input type="file" id="Product_pictures" accept="image/*" required>
                <p class="note-text">*‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Google Drive ‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô</p>
            </div>

            
        <hr>
<div class="addon-section">
    <h3 style="font-size:16px; margin-bottom:15px;">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (Add-on Services)</h3>
    
    <div class="form-group">
        <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πà‡∏ß‡∏ô (Service Speed)</label>
        <div class="radio-group">
            <label class="radio-item">
                <input type="radio" name="service_speed" value="0" checked onchange="calculateTotal()">
                ‡∏õ‡∏Å‡∏ï‡∏¥ (Standard) <span class="price">+0.-</span>
            </label>
            <label class="radio-item">
                <input type="radio" name="service_speed" value="89" onchange="calculateTotal()">
                ‡∏î‡πà‡∏ß‡∏ô 1-2 ‡∏ß‡∏±‡∏ô (Fast Track) <span class="price">+89.-</span>
            </label>
            <label class="radio-item">
                <input type="radio" name="service_speed" value="129" onchange="calculateTotal()">
                ‡∏î‡πà‡∏ß‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© 1 ‡∏ß‡∏±‡∏ô (Super Fast) <span class="price">+129.-</span>
            </label>
        </div>
    </div>

    <div class="form-group">
        <label>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏© (Extra Care)</label>
        <div class="checkbox-group">
            <label class="checkbox-item">
                <input type="checkbox" id="chk_yellow" value="299" onchange="calculateTotal()">
                ‡πÅ‡∏Å‡πâ‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á (Un-Yellowing) <span class="price">+299.-</span>
            </label>
            <label class="checkbox-item">
                <input type="checkbox" id="chk_ozone" value="159" onchange="calculateTotal()">
                ‡∏≠‡∏ö‡πÇ‡∏≠‡πÇ‡∏ã‡∏ô‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠ (Ozone) <span class="price">+159.-</span>
            </label>
        </div>
    </div>

    <div class="total-price-box">
        <div style="font-size: 14px; color: #666; margin-bottom: 5px;">
            (‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 189.-
             + ‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á 29.-)
        </div>
        <span>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô (Total)</span>
        <span class="price-text" id="displayTotal">218</span>
        <span style="font-size:18px;">‡∏ö‡∏≤‡∏ó</span>
    </div>
    <button type="button" class="btn-submit" onclick="openPayment()" style="background: #000; color: #fff; width: 100%; padding: 15px; border-radius: 8px; margin-top: 20px; cursor: pointer;">
        ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
    </button>
</div>

<div id="paymentModal" class="modal">
    <div class="modal-content">
        <h3>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (Payment)</h3>
        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>
        
        <img width="230" src="image/‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô.png" alt="PromptPay QR" class="qr-img">
        
        <div class="form-group" style="text-align: left; margin-top: 20px;">
            <label>‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (Upload Slip)</label>
            <input type="file" id="slipFile" accept="image/*" >
            <p class="note-text">*‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Google Drive ‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô</p>
        </div>
        <button type="submit" id="finalSubmit" class="btn-submit">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>
</div>
        </form>
    </div>

<div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <div class="spinner-box">
        <div class="spinner"></div>
        <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...</p>
        <p style="font-size: 12px; color: #aaa;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏≠‡∏¢‡πà‡∏≤‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</p>
    </div>
</div>

 <script>
    // üî• 1. Web App URL
const scriptURL = 'https://script.google.com/macros/s/AKfycbybiznNme-nKJE0MLtvRriebAIwZ9opj0Oo1SYrYE1MDVi3ht5n8ndojkaX8xHKF6Ho/exec';

const form = document.getElementById('bookingForm');
const btn = document.getElementById('finalSubmit');
const paymentModal = document.getElementById('paymentModal');
const loadingOverlay = document.getElementById('loadingOverlay'); // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Loading

function calculateTotal() {
    let basePrice = 189; // ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏±‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    let deliveryFee = 29; // ‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á
    let total = basePrice + deliveryFee; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà 218.-
    
    const shoeType = document.getElementById('shoeType').value;
    
    // ‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
    if (shoeType === 'Suede sneakers') total += 100;
    if (shoeType === 'sandals') total -= 110; 
    // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: (189 + 29) - 110 = 108.- ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ö

    // ‡∏ö‡∏ß‡∏Å‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πà‡∏ß‡∏ô‡∏à‡∏≤‡∏Å Radio
    const speedRadios = document.getElementsByName('service_speed');
    for (const radio of speedRadios) {
        if (radio.checked) {
            total += parseInt(radio.value);
            break; 
        }
    }

    // ‡∏ö‡∏ß‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏à‡∏≤‡∏Å Checkbox
    const chkYellow = document.getElementById('chk_yellow');
    const chkOzone = document.getElementById('chk_ozone');
    
    if (chkYellow && chkYellow.checked) total += 299;
    if (chkOzone && chkOzone.checked) total += 159; 

    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
    const displayTotal = document.getElementById('displayTotal');
    if(displayTotal) {
        displayTotal.innerText = total.toLocaleString();
    }
    
    return total;
}

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
calculateTotal();

function openPayment() {
    console.log("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°..."); 
    if (form.checkValidity()) {
        console.log("‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÄ‡∏õ‡∏¥‡∏î Modal");
        paymentModal.style.display = 'flex'; 
        calculateTotal(); 
    } else {
        console.log("‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö");
        Swal.fire({
            icon: 'warning',
            title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö',
            text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô',
            confirmButtonColor: '#000'
        });
        form.reportValidity();
    }
}

// ‡∏õ‡∏¥‡∏î Modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å
window.onclick = function(event) {
    if (event.target == paymentModal) {
        paymentModal.style.display = "none";
    }
}

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    btn.innerHTML = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";
    btn.disabled = true;
    loadingOverlay.style.display = 'flex'; // ‚úÖ ‡∏™‡∏±‡πà‡∏á‡πÅ‡∏™‡∏î‡∏á Loading

    const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve({
            base64: reader.result.split(',')[1],
            name: file.name,
            type: file.type
        });
        reader.onerror = error => reject(error);
    });

    try {
        const productInput = document.getElementById('Product_pictures');
        const slipInput = document.getElementById('slipFile');

        if (!productInput.files[0] || !slipInput.files[0]) {
            Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô', 'warning');
            btn.innerHTML = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
            btn.disabled = false;
            loadingOverlay.style.display = 'none'; // ‚úÖ ‡∏õ‡∏¥‡∏î loading ‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö
            return;
        }

        const productFileData = await toBase64(productInput.files[0]);
        const slipFileData = await toBase64(slipInput.files[0]);

        // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡πà‡∏ß‡∏ô (Text) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Sheet
        const speedRadio = document.querySelector('input[name="service_speed"]:checked');
        let serviceSpeedText = "‡∏õ‡∏Å‡∏ï‡∏¥ (Standard)";
        if (speedRadio) {
            serviceSpeedText = speedRadio.parentElement.innerText.replace(/\s+/g, ' ').trim();
        }

        // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏° (Text) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Sheet
        let addons = [];
        const chkYellow = document.getElementById('chk_yellow');
        const chkOzone = document.getElementById('chk_ozone');
        if (chkYellow && chkYellow.checked) addons.push("‡πÅ‡∏Å‡πâ‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á (Un-Yellowing)");
        if (chkOzone && chkOzone.checked) addons.push("‡∏≠‡∏ö‡πÇ‡∏≠‡πÇ‡∏ã‡∏ô‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠ (Ozone)");
        const addonsText = addons.length > 0 ? addons.join(", ") : "-";

        const payload = {
            phone: form.phone.value,
            shoe_type: form.shoe_type.value,
            brand: form.brand.value,
            model: form.model.value,
            pickup_date: form.pickup_date.value,
            return_date: form.return_date.value,
            address: form.address.value,
            note: form.note.value,
            service_speed: serviceSpeedText, // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πà‡∏ß‡∏ô‡πÑ‡∏õ Sheet
            addon_services: addonsText,      // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÑ‡∏õ Sheet
            total_price: calculateTotal(),
            productFile: productFileData.base64,
            productFileName: productFileData.name,
            productMimeType: productFileData.type,
            slipFile: slipFileData.base64,
            slipFileName: slipFileData.name,
            slipMimeType: slipFileData.type
        };

        const response = await fetch(scriptURL, { 
            method: 'POST', 
            body: JSON.stringify(payload) 
        });

        const result = await response.json();

        // ‚úÖ ‡∏õ‡∏¥‡∏î Loading ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
        loadingOverlay.style.display = 'none'; 

        if (result.result === 'success') {
            paymentModal.style.display = "none";
            Swal.fire({
                title: '‡∏à‡∏≠‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!',
                text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                icon: 'success',
                confirmButtonColor: '#000'
            }).then(() => {
                window.location.href = "index.html";
            });
        } else {
            throw new Error(result.error);
        }

    } catch (error) {
        console.error(error);
        loadingOverlay.style.display = 'none'; // ‚úÖ ‡∏õ‡∏¥‡∏î Loading ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Error
        Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
    } finally {
        btn.innerHTML = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        btn.disabled = false;
    }
});

// ‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
const pickupInput = document.getElementsByName('pickup_date')[0];
const returnInput = document.getElementsByName('return_date')[0];

pickupInput.addEventListener('change', function() {
    if (this.value) {
        let date = new Date(this.value);
        date.setDate(date.getDate() + 3); // ‡∏ö‡∏ß‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏° 3 ‡∏ß‡∏±‡∏ô
        returnInput.min = date.toISOString().split("T")[0];
        returnInput.value = date.toISOString().split("T")[0];
    }
});
</script>
</body>
</html>
